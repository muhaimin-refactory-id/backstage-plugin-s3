{"version":3,"file":"rules.cjs.js","sources":["../../src/permissions/rules.ts"],"sourcesContent":["import { makeCreatePermissionRule } from '@backstage/plugin-permission-node';\nimport {\n  S3_VIEWER_RESOURCE_TYPE,\n  BucketDetails,\n  BucketDetailsFilters,\n} from '@spreadshirt/backstage-plugin-s3-viewer-common';\nimport { z } from 'zod';\n\nconst createS3ViewerBucketPermissionRule = makeCreatePermissionRule<\n  BucketDetails,\n  BucketDetailsFilters,\n  typeof S3_VIEWER_RESOURCE_TYPE\n>();\n\nconst isBucketOwner = createS3ViewerBucketPermissionRule({\n  name: 'IS_BUCKET_OWNER',\n  description: 'Should allow only if the bucket belongs to the user',\n  resourceType: S3_VIEWER_RESOURCE_TYPE,\n  paramsSchema: z.object({\n    owners: z.array(z.string()).describe('List of owner entity refs'),\n  }),\n  apply: (list, { owners }) => owners.includes(list.owner),\n  toQuery: ({ owners }) => ({\n    property: 'owner',\n    values: owners,\n  }),\n});\n\nconst isBucketNamed = createS3ViewerBucketPermissionRule({\n  name: 'IS_BUCKET_NAMED',\n  description: 'Should allow only depending on the bucket name',\n  resourceType: S3_VIEWER_RESOURCE_TYPE,\n  paramsSchema: z.object({\n    names: z.array(z.string()).describe('List of bucket names'),\n  }),\n  apply: (list, { names }) => names.includes(list.bucket),\n  toQuery: ({ names }) => ({\n    property: 'bucket',\n    values: names,\n  }),\n});\n\nexport const rules = { isBucketOwner, isBucketNamed };\n"],"names":["makeCreatePermissionRule","S3_VIEWER_RESOURCE_TYPE","z"],"mappings":";;;;;;AAQA,MAAM,qCAAqCA,6CAIzC,EAAA;AAEF,MAAM,gBAAgB,kCAAmC,CAAA;AAAA,EACvD,IAAM,EAAA,iBAAA;AAAA,EACN,WAAa,EAAA,qDAAA;AAAA,EACb,YAAc,EAAAC,qDAAA;AAAA,EACd,YAAA,EAAcC,MAAE,MAAO,CAAA;AAAA,IACrB,MAAA,EAAQA,MAAE,KAAM,CAAAA,KAAA,CAAE,QAAQ,CAAA,CAAE,SAAS,2BAA2B;AAAA,GACjE,CAAA;AAAA,EACD,KAAA,EAAO,CAAC,IAAM,EAAA,EAAE,QAAa,KAAA,MAAA,CAAO,QAAS,CAAA,IAAA,CAAK,KAAK,CAAA;AAAA,EACvD,OAAS,EAAA,CAAC,EAAE,MAAA,EAAc,MAAA;AAAA,IACxB,QAAU,EAAA,OAAA;AAAA,IACV,MAAQ,EAAA;AAAA,GACV;AACF,CAAC,CAAA;AAED,MAAM,gBAAgB,kCAAmC,CAAA;AAAA,EACvD,IAAM,EAAA,iBAAA;AAAA,EACN,WAAa,EAAA,gDAAA;AAAA,EACb,YAAc,EAAAD,qDAAA;AAAA,EACd,YAAA,EAAcC,MAAE,MAAO,CAAA;AAAA,IACrB,KAAA,EAAOA,MAAE,KAAM,CAAAA,KAAA,CAAE,QAAQ,CAAA,CAAE,SAAS,sBAAsB;AAAA,GAC3D,CAAA;AAAA,EACD,KAAA,EAAO,CAAC,IAAM,EAAA,EAAE,OAAY,KAAA,KAAA,CAAM,QAAS,CAAA,IAAA,CAAK,MAAM,CAAA;AAAA,EACtD,OAAS,EAAA,CAAC,EAAE,KAAA,EAAa,MAAA;AAAA,IACvB,QAAU,EAAA,QAAA;AAAA,IACV,MAAQ,EAAA;AAAA,GACV;AACF,CAAC,CAAA;AAEY,MAAA,KAAA,GAAQ,EAAE,aAAA,EAAe,aAAc;;;;"}